#!/usr/bin/env ruby
require 'optparse'
require_relative '../lib/less2sass'
require_relative '../lib/less2sass/version'

options = {}

OptionParser.new do |opts|
  opts.banner = "Usage: less2sass inputfile.less [options]"

  opts.on("-o", "--output FILE.scss", "name of outputfile") do |o|
    options[:outputfile] = true
    options[:outputfilename] = o
  end

  opts.on("-d", "--delete", "delete inputfile after outputfile is created") do |d|
    options[:delete] = d
  end

  opts.on("-p", "--print", "output sass results to the terminal") do |p|
    options[:print] = p
  end

  opts.on("-v", "--version", "print less2sass version") do |v|
    options[:version] = v
  end
end.parse!

if options[:version]
  puts "Version: #{Less2Sass::Version}"
  puts " "
end

if ARGV.size < 1
  system "less2sass -h"
else
  input_file = ARGV[0]

  if input_file[-5, 5] == ".less"
    src = File.read input_file
    sass = Less2Sass.convert src

    if options[:print]
      puts sass
      exit
    end

    if options[:outputfile] && options[:outputfilename][-5, 5] == ".scss"
      output_file = options[:outputfilename]
    else
      output_file = input_file.gsub(".less", ".scss")
    end

    File.open output_file, 'w' do |file|
      file << sass
    end

    if File.file?(output_file)
      if options[:delete]
          File.delete(input_file)

        if File.file?(input_file) == false
          puts "Deleted: #{input_file}"
        else
          puts "Issue Deleting: #{input_file}"
        end
      end
    end

    puts "Done: #{output_file}"
  else
    puts "Error: #{input_file} is not a valid .less file"
    system "less2sass -h"
    exit
  end

  puts "---------------------"
end